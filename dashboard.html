<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trash2Go | Junkshop Inventory Monitor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Light gray background */
        }
        .scrollable-table {
            max-height: 400px;
            overflow-y: auto;
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div id="app" class="max-w-6xl mx-auto">
        <header class="mb-8 p-4 bg-white shadow-lg rounded-xl flex justify-between items-center">
            <div>
                <h1 class="text-4xl font-extrabold text-green-700">‚ôªÔ∏è Trash2Go</h1>
                <p class="text-gray-600 mt-1">Real-time Junkshop Inventory & Monitoring</p>
            </div>
            <button id="sign-out-btn" class="bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded-lg transition duration-150 ease-in-out shadow-md text-sm">
                Sign Out
            </button>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

            <div class="lg:col-span-1 bg-white p-6 shadow-xl rounded-xl h-fit">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4 border-b pb-2">Update Inventory</h2>
                <form id="inventory-form">
                    <div class="mb-4">
                        <label for="item-name" class="block text-sm font-medium text-gray-700">Item Name</label>
                        <input type="text" id="item-name" placeholder="e.g., Used Cardboard" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500 p-2 border">
                    </div>

                    <div class="mb-4">
                        <label for="item-category" class="block text-sm font-medium text-gray-700">Category</label>
                        <select id="item-category" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500 p-2 border bg-white">
                            <option value="" disabled selected>Select Category</option>
                            <option value="Metal">Metal (Steel/Aluminum)</option>
                            <option value="Plastic">Plastic (PET/HDPE)</option>
                            <option value="Paper">Paper (Cardboard/Newspaper)</option>
                            <option value="Glass">Glass</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>

                    <div class="mb-4">
                        <label for="item-stock" class="block text-sm font-medium text-gray-700">Current Stock (kg)</label>
                        <input type="number" id="item-stock" step="0.01" min="0" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500 p-2 border" value="0">
                    </div>

                    <button type="submit" id="submit-btn" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg transition duration-150 ease-in-out shadow-md">
                        Add/Update Item
                    </button>
                    <div id="error-message" class="mt-3 text-red-600 text-sm hidden"></div>
                </form>
            </div>

            <div class="lg:col-span-2">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div class="bg-blue-100 p-5 rounded-xl shadow-lg border-l-4 border-blue-500">
                        <p class="text-sm font-medium text-blue-600">Total Inventory Value</p>
                        <p id="total-value" class="text-3xl font-bold text-blue-800 mt-1">0.00</p>
                    </div>
                    <div class="bg-yellow-100 p-5 rounded-xl shadow-lg border-l-4 border-yellow-500">
                        <p class="text-sm font-medium text-yellow-600">Total Stock (KG)</p>
                        <p id="total-weight" class="text-3xl font-bold text-yellow-800 mt-1">0.00</p>
                    </div>
                    <div class="bg-purple-100 p-5 rounded-xl shadow-lg border-l-4 border-purple-500">
                        <p class="text-sm font-medium text-purple-600">Total Unique Items</p>
                        <p id="item-count" class="text-3xl font-bold text-purple-800 mt-1">0</p>
                    </div>
                </div>

                <div class="bg-white p-6 shadow-xl rounded-xl">
                    <h2 class="text-2xl font-semibold text-gray-800 mb-4">Current Stock Overview</h2>
                    <div class="scrollable-table">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50 sticky top-0">
                                <tr>
                                    <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Item</th>
                                    <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden sm:table-cell">Category</th>
                                    <th class="px-3 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Stock (kg)</th>
                                    <th class="px-3 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Value</th>
                                </tr>
                            </thead>
                            <tbody id="inventory-table-body" class="bg-white divide-y divide-gray-200">
                                <tr><td colspan="4" class="p-4 text-center text-gray-500">Inventory will load here...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, onSnapshot, collection, query } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // IMPORTANT: Global variables provided by the Canvas environment
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;

        let db = null;
        let auth = null;
        const LOGIN_PAGE = 'login.html'; // Assuming the login page is named login.html

        // DOM elements
        const signOutBtn = document.getElementById('sign-out-btn');
        const inventoryTableBody = document.getElementById('inventory-table-body');
        const totalValueEl = document.getElementById('total-value');
        const totalWeightEl = document.getElementById('total-weight');
        const itemCountEl = document.getElementById('item-count');

        // --- Auth Check and Initialization ---
        async function initFirebase() {
            if (!firebaseConfig) {
                console.error('Firebase config is missing. Cannot initialize app.');
                redirectToLogin();
                return;
            }

            try {
                const app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);
                
                // Set up auth state listener
                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        // User is signed in, load data
                        loadInventory();
                    } else {
                        // User is signed out, redirect to login
                        redirectToLogin();
                    }
                });

            } catch (error) {
                console.error("Firebase initialization error:", error);
                redirectToLogin();
            }
        }

        function redirectToLogin() {
             // In a real environment, you'd redirect here:
             // window.location.href = LOGIN_PAGE;
             console.log("Redirecting to login page (simulated).");
             // For demonstration, we'll stop execution here if auth fails
             document.body.innerHTML = '<div class="text-center mt-20"><p class="text-xl text-red-500">Access Denied. Redirecting to login...</p></div>';
        }

        // --- Data Retrieval (Simplified from the original) ---

        function getInventoryCollectionRef() {
            if (!db) return null;
            // Use the public data path from the original script
            const path = `artifacts/${appId}/public/data/inventory_items`;
            return collection(db, path);
        }

        function loadInventory() {
            const collectionRef = getInventoryCollectionRef();
            if (!collectionRef) {
                inventoryTableBody.innerHTML = '<tr><td colspan="4" class="p-4 text-center text-red-600">Database connection failed.</td></tr>';
                return;
            }

            const q = query(collectionRef);

            onSnapshot(q, (snapshot) => {
                const inventoryItems = [];
                let totalValue = 0;
                let totalWeight = 0;

                snapshot.forEach((doc) => {
                    const data = doc.data();
                    const value = data.stock_kg * data.price_per_kg;
                    inventoryItems.push({ id: doc.id, ...data, value: value });
                    totalValue += data.stock_kg * data.price_per_kg;
                    totalWeight += data.stock_kg;
                });

                inventoryItems.sort((a, b) => a.name.localeCompare(b.name));

                renderInventory(inventoryItems);
                updateSummary(totalValue, totalWeight, inventoryItems.length);

            }, (error) => {
                console.error("Error listening to inventory:", error);
                inventoryTableBody.innerHTML = '<tr><td colspan="4" class="p-4 text-center text-red-600">Failed to load inventory data.</td></tr>';
            });
        }

        function renderInventory(items) {
             if (items.length === 0) {
                 inventoryTableBody.innerHTML = '<tr><td colspan="4" class="p-4 text-center text-gray-500">No items currently in stock.</td></tr>';
                 return;
             }
             // Using map and join to create HTML rows efficiently
             inventoryTableBody.innerHTML = items.map(item => {
                 return `
                     <tr class="hover:bg-gray-100 transition duration-100">
                         <td class="px-3 py-3 whitespace-nowrap text-sm font-medium text-gray-900">${item.name}</td>
                         <td class="px-3 py-3 whitespace-nowrap text-sm text-gray-500 hidden sm:table-cell">${item.category}</td>
                         <td class="px-3 py-3 whitespace-nowrap text-sm text-gray-500 text-right">${item.stock_kg.toFixed(2)}</td>
                         <td class="px-3 py-3 whitespace-nowrap text-sm font-bold text-green-600 text-right">${item.value.toFixed(2)}</td>
                     </tr>
                 `;
             }).join('');
        }

        function updateSummary(totalValue, totalWeight, itemCount) {
            totalValueEl.textContent = totalValue.toFixed(2);
            totalWeightEl.textContent = totalWeight.toFixed(2);
            itemCountEl.textContent = itemCount;
        }

        // --- Sign Out Handler ---
        signOutBtn.addEventListener('click', async () => {
            try {
                await signOut(auth);
                // Redirection is handled by the onAuthStateChanged listener
            } catch (error) {
                console.error("Error signing out:", error);
                alert("Failed to sign out. Please try again.");
            }
        });

        // Initialize the application
        initFirebase();
    </script>
</body>
</html>
üöÄ Next Step
For a complete working prototype, you should make the following change to your login.html file (the one I generated previously) to enable redirection:

In the handleAuth function of your login.html script, change the successful sign-in block:

JavaScript

// login.html - inside handleAuth(action) try block

// ... (after userCredential is set)

// Success is handled by the onAuthStateChanged listener, which will redirect.
console.log(`${action} successful:`, userCredential.user.uid);
showLoading(false, action);
loginForm.reset();

// **ADD THIS LINE FOR REDIRECTION**
window.location.href = 'dashboard.html'; // Redirect to the new dashboard file